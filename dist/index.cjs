"use strict";const t=require("react/jsx-runtime");require("leaflet-defaulticon-compatibility");const y=require("react-leaflet"),l=require("react"),V=require("leaflet-geosearch"),$=require("@heroui/autocomplete"),F=require("leaflet"),D=require("@heroui/spinner"),w=require("swr"),I=require("@heroui/card"),Y=require("@heroui/button"),z=require("@heroui/input"),B=({value:e,onChange:s})=>(y.useMapEvents({click(n){if(!n.latlng)return;const{lat:o,lng:c}=n.latlng;s([o,c])}}),e?t.jsx(y.Marker,{position:e}):null),R=()=>{const e=l.useRef(null);return l.useEffect(()=>{e.current&&F.DomEvent.disableClickPropagation(e.current)},[e.current]),e},G=()=>t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})}),U=()=>t.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),t.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),_=l.memo(()=>{const[e,s]=l.useState(""),[n,o]=l.useState([]),c=R(),i=y.useMap(),p=new V.OpenStreetMapProvider({params:{"accept-language":"ua",countrycodes:"ua,pl,by,ru,ro,md,tr",limit:5,email:"admin@duckarchive.com"}}),u=l.useCallback(async a=>{if(!a.trim()){o([]);return}try{const f=await p.search({query:a});o(f)}catch{o([])}},[p]);l.useEffect(()=>{const a=setTimeout(()=>{u(e)},300);return()=>clearTimeout(a)},[e]);const h=a=>{s(a.label),i.setView([a.y,a.x],15),i.fire("geosearch/showlocation",{location:a,marker:null})},j=a=>{s(a)},x=a=>{if(a){const f=n[a];f&&h(f)}};return t.jsx("div",{ref:c,className:"absolute leaflet-top leaflet-left",children:t.jsx($.Autocomplete,{"aria-label":"Пошук за сучасною назвою",className:"leaflet-control w-auto bg-white rounded-xl shadow",defaultItems:n,inputValue:e,listboxProps:{emptyContent:"Нічого не знайдено. Уточніть свій запит."},placeholder:"Пошук за сучасною назвою",startContent:t.jsx(G,{}),variant:"bordered",onClick:a=>a.stopPropagation(),onInputChange:j,onMouseDown:a=>a.stopPropagation(),onSelectionChange:x,children:a=>t.jsx($.AutocompleteItem,{startContent:t.jsx(U,{}),textValue:a.label,children:a.label},n.indexOf(a))})})});_.displayName="MapLocationSearch";const r="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson",T=[{year:1500,url:`${r}/countries/1500.geojson`},{year:1530,url:`${r}/countries/1530.geojson`},{year:1600,url:`${r}/countries/1600.geojson`},{year:1650,url:`${r}/countries/1650.geojson`},{year:1700,url:`${r}/countries/1700.geojson`},{year:1715,url:`${r}/countries/1715.geojson`},{year:1783,url:`${r}/countries/1783.geojson`},{year:1800,url:`${r}/countries/1800.geojson`},{year:1815,url:`${r}/countries/1815.geojson`},{year:1880,url:`${r}/countries/1880.geojson`},{year:1900,url:`${r}/countries/1900.geojson`},{year:1914,url:`${r}/countries/1914.geojson`},{year:1920,url:`${r}/countries/1920.geojson`},{year:1930,url:`${r}/countries/1930.geojson`},{year:1938,url:`${r}/countries/1938.geojson`},{year:1945,url:`${r}/countries/1945.geojson`},{year:1960,url:`${r}/countries/1960.geojson`},{year:1991,url:`${r}/countries/1991.geojson`}],A=[{year:1897,url:`${r}/states/1897.geojson`},{year:1914,url:`${r}/states/1914.geojson`},{year:1937,url:`${r}/states/1937.geojson`},{year:1945,url:`${r}/states/1945.geojson`},{year:1991,url:`${r}/states/1991.geojson`}],M=(e,s,n=!1)=>{if(n){const c=s.find(({year:i})=>i===e);return c?c.url:null}const o=s.filter(({year:c})=>c>0&&c<=e).sort((c,i)=>i.year-c.year);return o.length>0?o[0].url:null},O=e=>fetch(e).then(s=>s.json()),H=e=>{const[s,n]=l.useState(e),o=M(s,T),{data:c,isLoading:i,isValidating:p}=w(o,O,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),u=M(s,A,!0),{data:h,isLoading:j,isValidating:x}=w(u,O,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),a=l.useMemo(()=>c||null,[c]),f=l.useMemo(()=>h||null,[h]);return{countries:a,states:f,updateYear:g=>{n(g)},isLoading:i||j||p||x}},J=({level1:e,level2:s,level3:n})=>t.jsx("div",{className:"absolute leaflet-bottom leaflet-left",children:t.jsx(I.Card,{className:"leaflet-control max-w-sm pointer-events-none rounded-xl",children:t.jsx(I.CardBody,{className:"py-2",children:t.jsxs("div",{className:"flex flex-col gap-0",children:[n&&t.jsx("p",{className:"text-large",children:n}),s&&t.jsx("p",{className:"text-small text-default-500",children:s}),e&&t.jsx("p",{className:"text-small text-default-500",children:e})]})})})}),K=[{value:1897,label:"Російська Імперія"},{value:1914,label:"WWI"},{value:1937,label:"Перед WWII"},{value:1945,label:"Після WWII"},{value:1991,label:"Незалежність"}],Z=e=>{const s=parseInt(e,10);return/^\d{4}$/.test(e)&&s>=1500&&s<=1991},Q=({value:e,onChange:s})=>{const[n,o]=l.useState(e.toString()),[c,i]=l.useState(!1),[p,u]=l.useState(!1),h=R(),j=d=>{const g=d.replace(/\D/g,"").slice(0,4);if(o(g),g.length===4){const b=Z(g);u(!b),b&&s(parseInt(g,10))}else u(!1)},x=d=>{o(d.toString()),s(d),i(!1),u(!1)},a=()=>{i(!0)},f=()=>{setTimeout(()=>i(!1),150)};return t.jsx("div",{ref:h,className:"absolute leaflet-top leaflet-right",children:t.jsxs("div",{className:"leaflet-control bg-white rounded-xl shadow",children:[t.jsx(z.Input,{classNames:{inputWrapper:"bg-default-100 relative",input:"text-sm"},errorMessage:p?"Введіть рік від 1600 до 2025":"",isInvalid:p,placeholder:"1897",type:"text",value:n,variant:"bordered",onBlur:f,onFocus:a,onValueChange:j}),c&&t.jsx("div",{className:"flex flex-col gap-1 p-2",children:K.map(d=>t.jsxs(Y.Button,{className:"text-xs justify-start",color:"default",size:"sm",variant:e===d.value?"flat":"bordered",onPress:()=>x(d.value),children:[d.value," - ",d.label]},d.value))})]})})},W=["green","darkblue","purple","orange","blue","red","yellow"],X=e=>{var o;const s=((o=e.properties)==null?void 0:o.admin_level_1_ID)||e.id||0;if(s===22)return"gold";const n=s%W.length;return W[n]},S=(e,s,n=1)=>{const o=e?X(e):"gray";return{color:o,fillColor:o,weight:n,opacity:s?1:.5,fillOpacity:s?.1:0,interactive:!0}},q=l.memo(l.forwardRef(({data:e,onEachFeature:s},n)=>e?t.jsx(y.GeoJSON,{ref:n,data:e,style:o=>S(o,!1,0),onEachFeature:s}):null));q.displayName="CountriesLayer";const E=l.memo(({data:e,onEachFeature:s})=>e?t.jsx(y.GeoJSON,{data:e,style:n=>S(n,!1,2),onEachFeature:s}):null);E.displayName="StatesLayer";const ee=({year:e=1897})=>{var d,g,b;const[s,n]=l.useState(null),[o,c]=l.useState(null),[i,p]=l.useState(e),{countries:u,states:h,updateYear:j,isLoading:x}=H(i);l.useEffect(()=>{j(i),n(null),c(null)},[i]);const a=l.useCallback((m,C)=>{C.on({mouseover:v=>{n(m),v.target.setStyle(S(m,!1,1))},mouseout:v=>{n(null),v.target.setStyle(S(m,!1,0))}})},[]),f=l.useCallback((m,C)=>{C.on({mouseover:v=>{c(m);const k=u==null?void 0:u.features.find(P=>{var L,N;return((L=P.id)==null?void 0:L.toString())===((N=m.properties)==null?void 0:N.admin_level_1_ID.toString())});k&&n(k),v.target.setStyle(S(m,!0,4))},mouseout:v=>{c(null),v.target.setStyle(S(m,!1,2))}})},[u]);return t.jsxs(t.Fragment,{children:[x?t.jsx("div",{className:"absolute z-[1001] top-0 left-0 w-full h-full flex items-center justify-center backdrop-blur-sm bg-white/50",children:t.jsx(D.Spinner,{})}):t.jsxs(t.Fragment,{children:[u&&t.jsx(q,{data:u,onEachFeature:a}),h&&t.jsx(E,{data:h,onEachFeature:f})]}),t.jsx(Q,{value:i,onChange:p}),(s||o)&&t.jsx(J,{level1:(d=s==null?void 0:s.properties)==null?void 0:d.admin_level_1,level2:(g=o==null?void 0:o.properties)==null?void 0:g.admin_level_2,level3:(b=o==null?void 0:o.properties)==null?void 0:b.admin_level_3})]})},te="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson/ukraine.geojson",se=e=>fetch(e).then(s=>s.json()),ne=()=>{const{data:e}=w(te,se,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1});return e&&t.jsx(y.GeoJSON,{data:e,style:{color:"gray",weight:4,fillColor:"transparent",opacity:.4,interactive:!1}})},oe=({position:e,onPositionChange:s,tileLayerProps:n,...o})=>t.jsxs(y.MapContainer,{scrollWheelZoom:!0,worldCopyJump:!0,center:[49.0139,31.2858],style:{height:"100%",width:"100%"},zoom:6,zoomControl:!1,...o,children:[t.jsx(y.TileLayer,{className:"grayscale",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',...n,url:n.url||"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.jsx(ne,{}),t.jsx(_,{}),t.jsx(ee,{}),t.jsx(B,{value:e,onChange:s})]});module.exports=oe;
//# sourceMappingURL=index.cjs.map
