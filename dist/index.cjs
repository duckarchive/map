"use strict";const t=require("react/jsx-runtime");require("leaflet-defaulticon-compatibility");const j=require("react-leaflet"),c=require("react"),F=require("leaflet-geosearch"),$=require("@heroui/autocomplete"),L=require("leaflet"),D=require("@heroui/spinner"),k=require("swr"),M=require("@heroui/card"),Y=require("@heroui/button"),z=require("@heroui/input"),B=({value:e,onChange:s})=>(j.useMapEvents({click(a){if(!a.latlng)return;const{lat:o,lng:n}=a.latlng;s([o,n])}}),e?t.jsx(j.Marker,{position:e}):null),_=()=>{const e=c.useRef(null);return c.useEffect(()=>{e.current&&L.DomEvent.disableClickPropagation(e.current)},[e.current]),e},G=()=>t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})}),U=()=>t.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),t.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),q=c.memo(()=>{const[e,s]=c.useState(""),[a,o]=c.useState([]),n=_(),u=j.useMap(),f=new F.OpenStreetMapProvider({params:{"accept-language":"ua",countrycodes:"ua,pl,by,ru,ro,md,tr",limit:5,email:"admin@duckarchive.com"}}),i=c.useCallback(async r=>{if(!r.trim()){o([]);return}try{const p=await f.search({query:r});o(p)}catch{o([])}},[f]);c.useEffect(()=>{const r=setTimeout(()=>{i(e)},300);return()=>clearTimeout(r)},[e]);const g=r=>{s(r.label),u.setView([r.y,r.x],15),u.fire("geosearch/showlocation",{location:r,marker:null})},x=r=>{s(r)},y=r=>{if(r){const p=a[r];p&&g(p)}};return t.jsx("div",{ref:n,className:"absolute leaflet-top leaflet-left",children:t.jsx($.Autocomplete,{"aria-label":"Пошук за сучасною назвою",className:"leaflet-control w-auto bg-white rounded-xl shadow",defaultItems:a,inputValue:e,listboxProps:{emptyContent:"Нічого не знайдено. Уточніть свій запит."},placeholder:"Пошук за сучасною назвою",startContent:t.jsx(G,{}),variant:"bordered",onClick:r=>r.stopPropagation(),onInputChange:x,onMouseDown:r=>r.stopPropagation(),onSelectionChange:y,children:r=>t.jsx($.AutocompleteItem,{startContent:t.jsx(U,{}),textValue:r.label,children:r.label},a.indexOf(r))})})});q.displayName="MapLocationSearch";const l="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson",T=[{year:1500,url:`${l}/countries/1500.geojson`},{year:1530,url:`${l}/countries/1530.geojson`},{year:1600,url:`${l}/countries/1600.geojson`},{year:1650,url:`${l}/countries/1650.geojson`},{year:1700,url:`${l}/countries/1700.geojson`},{year:1715,url:`${l}/countries/1715.geojson`},{year:1783,url:`${l}/countries/1783.geojson`},{year:1800,url:`${l}/countries/1800.geojson`},{year:1815,url:`${l}/countries/1815.geojson`},{year:1880,url:`${l}/countries/1880.geojson`},{year:1900,url:`${l}/countries/1900.geojson`},{year:1914,url:`${l}/countries/1914.geojson`},{year:1920,url:`${l}/countries/1920.geojson`},{year:1930,url:`${l}/countries/1930.geojson`},{year:1938,url:`${l}/countries/1938.geojson`},{year:1945,url:`${l}/countries/1945.geojson`},{year:1960,url:`${l}/countries/1960.geojson`},{year:1991,url:`${l}/countries/1991.geojson`}],A=[{year:1897,url:`${l}/states/1897.geojson`},{year:1914,url:`${l}/states/1914.geojson`},{year:1937,url:`${l}/states/1937.geojson`},{year:1945,url:`${l}/states/1945.geojson`},{year:1991,url:`${l}/states/1991.geojson`}],W=(e,s,a=!1)=>{if(a){const n=s.find(({year:u})=>u===e);return n?n.url:null}const o=s.filter(({year:n})=>n>0&&n<=e).sort((n,u)=>u.year-n.year);return o.length>0?o[0].url:null},R=e=>fetch(e).then(s=>s.json()),H=e=>{const[s,a]=c.useState(e),o=W(s,T),{data:n,isLoading:u,isValidating:f}=k(o,R,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),i=W(s,A,!0),{data:g,isLoading:x,isValidating:y}=k(i,R,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),r=c.useMemo(()=>n||null,[n]),p=c.useMemo(()=>g||null,[g]);return{countries:r,states:p,updateYear:m=>{a(m)},isLoading:u||x||f||y}},J=({level1:e,level2:s,level3:a})=>t.jsx("div",{className:"absolute leaflet-bottom leaflet-left",children:t.jsx(M.Card,{className:"leaflet-control max-w-sm pointer-events-none rounded-xl",children:t.jsx(M.CardBody,{className:"py-2",children:t.jsxs("div",{className:"flex flex-col gap-0",children:[a&&t.jsx("p",{className:"text-large",children:a}),s&&t.jsx("p",{className:"text-small text-default-500",children:s}),e&&t.jsx("p",{className:"text-small text-default-500",children:e})]})})})}),K=[{value:1897,label:"Російська Імперія"},{value:1914,label:"WWI"},{value:1937,label:"Перед WWII"},{value:1945,label:"Після WWII"},{value:1991,label:"Незалежність"}],Z=e=>{const s=parseInt(e,10);return/^\d{4}$/.test(e)&&s>=1500&&s<=1991},Q=({value:e,onChange:s})=>{const[a,o]=c.useState(e.toString()),[n,u]=c.useState(!1),[f,i]=c.useState(!1),g=_(),x=d=>{const m=d.replace(/\D/g,"").slice(0,4);if(o(m),m.length===4){const b=Z(m);i(!b),b&&s(parseInt(m,10))}else i(!1)},y=d=>{o(d.toString()),s(d),u(!1),i(!1)},r=()=>{u(!0)},p=()=>{setTimeout(()=>u(!1),150)};return t.jsx("div",{ref:g,className:"absolute leaflet-top leaflet-right",children:t.jsxs("div",{className:"leaflet-control bg-white rounded-xl shadow",children:[t.jsx(z.Input,{classNames:{inputWrapper:"bg-default-100 relative",input:"text-sm"},errorMessage:f?"Введіть рік від 1600 до 2025":"",isInvalid:f,placeholder:"1897",type:"text",value:a,variant:"bordered",onBlur:p,onFocus:r,onValueChange:x}),n&&t.jsx("div",{className:"flex flex-col gap-1 p-2",children:K.map(d=>t.jsxs(Y.Button,{className:"text-xs justify-start",color:"default",size:"sm",variant:e===d.value?"flat":"bordered",onPress:()=>y(d.value),children:[d.value," - ",d.label]},d.value))})]})})},O=["green","darkblue","purple","orange","blue","red","yellow"],X=e=>{var o;const s=((o=e.properties)==null?void 0:o.admin_level_1_ID)||e.id||0;if(s===22)return"gold";const a=s%O.length;return O[a]},S=(e,s,a=1)=>{const o=e?X(e):"gray";return{color:o,fillColor:o,weight:a,opacity:s?1:.5,fillOpacity:s?.1:0,interactive:!0}},E=c.memo(c.forwardRef(({data:e,onEachFeature:s},a)=>e?t.jsx(j.GeoJSON,{ref:a,data:e,style:o=>S(o,!1,0),onEachFeature:s}):null));E.displayName="CountriesLayer";const P=c.memo(({data:e,onEachFeature:s})=>e?t.jsx(j.GeoJSON,{data:e,style:a=>S(a,!1,2),onEachFeature:s}):null);P.displayName="StatesLayer";const ee=({defaultYear:e})=>{var d,m,b;const[s,a]=c.useState(null),[o,n]=c.useState(null),[u,f]=c.useState(e),{countries:i,states:g,updateYear:x,isLoading:y}=H(u);c.useEffect(()=>{x(u),a(null),n(null)},[u]);const r=c.useCallback((h,C)=>{C.on({mouseover:v=>{a(h),v.target.setStyle(S(h,!1,1))},mouseout:v=>{a(null),v.target.setStyle(S(h,!1,0))}})},[]),p=c.useCallback((h,C)=>{C.on({mouseover:v=>{n(h);const w=i==null?void 0:i.features.find(V=>{var N,I;return((N=V.id)==null?void 0:N.toString())===((I=h.properties)==null?void 0:I.admin_level_1_ID.toString())});w&&a(w),v.target.setStyle(S(h,!0,4))},mouseout:v=>{n(null),v.target.setStyle(S(h,!1,2))}})},[i]);return t.jsxs(t.Fragment,{children:[y?t.jsx("div",{className:"absolute z-[1001] top-0 left-0 w-full h-full flex items-center justify-center backdrop-blur-sm bg-white/50",children:t.jsx(D.Spinner,{})}):t.jsxs(t.Fragment,{children:[i&&t.jsx(E,{data:i,onEachFeature:r}),g&&t.jsx(P,{data:g,onEachFeature:p})]}),t.jsx(Q,{value:u,onChange:f}),(s||o)&&t.jsx(J,{level1:(d=s==null?void 0:s.properties)==null?void 0:d.admin_level_1,level2:(m=o==null?void 0:o.properties)==null?void 0:m.admin_level_2,level3:(b=o==null?void 0:o.properties)==null?void 0:b.admin_level_3})]})},te="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson/ukraine.geojson",se=e=>fetch(e).then(s=>s.json()),ne=()=>{const{data:e}=k(te,se,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1});return e&&t.jsx(j.GeoJSON,{data:e,style:{color:"gray",weight:4,fillColor:"transparent",opacity:.4,interactive:!1}})},oe=({position:e,onPositionChange:s,tileLayerProps:a,defaultYear:o=1897,hideLayers:n,...u})=>t.jsxs(j.MapContainer,{scrollWheelZoom:!0,worldCopyJump:!0,center:[49.0139,31.2858],style:{height:"100%",width:"100%"},zoom:6,zoomControl:!1,...u,children:[t.jsx(j.TileLayer,{className:"grayscale",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",...a}),!(n!=null&&n.ukraineLayer)&&t.jsx(ne,{}),!(n!=null&&n.searchInput)&&t.jsx(q,{}),!(n!=null&&n.historicalLayers)&&t.jsx(ee,{defaultYear:o}),!(n!=null&&n.locationMarker)&&t.jsx(B,{value:e,onChange:s})]});module.exports=oe;
//# sourceMappingURL=index.cjs.map
