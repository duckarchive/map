"use strict";const o=require("react/jsx-runtime"),m=require("react-leaflet"),u=require("react"),y=require("leaflet"),F=require("leaflet-geosearch"),z=require("@heroui/autocomplete"),q=require("@heroui/spinner"),S=require("swr"),N=require("@heroui/card"),B=require("@heroui/button"),P=require("@heroui/input"),H=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 384 512"><path stroke="none" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),T=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 384 512"><path stroke="none" d="M352 128h-96V32c0-17.67-14.33-32-32-32h-64c-17.67 0-32 14.33-32 32v96H32c-17.67 0-32 14.33-32 32v64c0 17.67 14.33 32 32 32h96v224c0 17.67 14.33 32 32 32h64c17.67 0 32-14.33 32-32V256h96c17.67 0 32-14.33 32-32v-64c0-17.67-14.33-32-32-32z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),U=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24"><path stroke="none" d="M8.433 6H3l-.114.006a1 1 0 0 0-.743 1.508L4.833 12l-2.69 4.486-.054.1A1 1 0 0 0 3 18h5.434l2.709 4.514.074.108a1 1 0 0 0 1.64-.108L15.565 18H21l.114-.006a1 1 0 0 0 .743-1.508L19.166 12l2.691-4.486.054-.1A1 1 0 0 0 21 6h-5.434l-2.709-4.514a1 1 0 0 0-1.714 0L8.433 6z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),Y=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24"><path fill="none" stroke="none" d="M0 0h24v24H0z"/><path stroke="none" d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm2.5 11.59.9 3.88-3.4-2.05-3.4 2.05.9-3.87-3-2.59 3.96-.34L12 6.02l1.54 3.64 3.96.34-3 2.59z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),G=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512"><path stroke="none" d="m243.4 2.6-224 96c-14 6-21.8 21-18.7 35.8S16.8 160 32 160v8c0 13.3 10.7 24 24 24h400c13.3 0 24-10.7 24-24v-8c15.2 0 28.3-10.7 31.3-25.6s-4.8-29.9-18.7-35.8l-224-96c-8-3.4-17.2-3.4-25.2 0zM128 224H64v196.3c-.6.3-1.2.7-1.8 1.1l-48 32c-11.7 7.8-17 22.4-12.9 35.9S17.9 512 32 512h448c14.1 0 26.5-9.2 30.6-22.7s-1.1-28.1-12.9-35.9l-48-32c-.6-.4-1.2-.7-1.8-1.1L448 224h-64v192h-40V224h-64v192h-48V224h-64v192h-40V224zM256 64a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),Z=y.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 448 512"><path stroke="none" d="M436 480h-20V24c0-13.255-10.745-24-24-24H56C42.745 0 32 10.745 32 24v456H12c-6.627 0-12 5.373-12 12v20h448v-20c0-6.627-5.373-12-12-12zM128 76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76zm0 96c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40zm52 148h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12zm76 160h-64v-84c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v84zm64-172c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40z"/></svg>',className:"io5-icon",iconSize:[20,20],iconAnchor:[10,30]}),O={pinIcon:H,christChurchIcon:T,jewChurchIcon:U,crimeIcon:Y,govIcon:G,gov2Icon:Z},J=({value:e})=>{if(!e)return null;const t=O[e[4]||"pinIcon"],s=[e[0],e[1]];return o.jsxs(o.Fragment,{children:[o.jsx(m.Marker,{position:s,icon:t,children:e[3]&&o.jsx(m.Tooltip,{direction:"top",offset:[0,-30],children:e[3]})}),e[2]&&e[2]>0&&o.jsx(m.Circle,{center:s,radius:e[2],pathOptions:{color:"currentColor",fillColor:"currentColor",fillOpacity:.2,weight:0}})]})},K=({value:e,onChange:t})=>{const s=m.useMap();if(m.useMapEvents({click(l){if(!l.latlng)return;const{lat:n,lng:d}=l.latlng;t==null||t([n,d,e[2]||0])}}),u.useEffect(()=>{const l=h=>{if(h.ctrlKey){h.preventDefault(),h.stopPropagation(),h.stopImmediatePropagation();const v=h.deltaY,g=100,x=100,r=1e4;let a=e[2]||0;v<0?a=Math.min((e[2]||0)+g,r):a=Math.max((e[2]||0)-g,x),a!==e[2]&&(t==null||t([e[0],e[1],a]))}},n=h=>{h.key==="Control"&&s.scrollWheelZoom.disable()},d=h=>{h.key==="Control"&&s.scrollWheelZoom.enable()},p=s.getContainer();return p.addEventListener("wheel",l,{passive:!1,capture:!0}),document.addEventListener("keydown",n),document.addEventListener("keyup",d),()=>{p.removeEventListener("wheel",l,{capture:!0}),document.removeEventListener("keydown",n),document.removeEventListener("keyup",d),s.scrollWheelZoom.enable()}},[s,e,t]),!e)return null;const c=[e[0],e[1]];return o.jsxs(o.Fragment,{children:[o.jsx(m.Marker,{position:c,icon:O.pinIcon}),e[2]&&e[2]>0&&o.jsx(m.Circle,{center:c,radius:e[2],pathOptions:{color:"currentColor",fillColor:"currentColor",fillOpacity:.2,weight:0}})]})},L=({value:e,onChange:t})=>!t?o.jsx(J,{value:e}):o.jsx(K,{value:e,onChange:t}),R=()=>{const e=u.useRef(null);return u.useEffect(()=>{e.current&&y.DomEvent.disableClickPropagation(e.current)},[e.current]),e},Q=()=>o.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})}),X=()=>o.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[o.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),o.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),V=u.memo(({onSelect:e})=>{const[t,s]=u.useState(""),[c,l]=u.useState([]),n=R(),d=m.useMap(),p=new F.OpenStreetMapProvider({params:{"accept-language":"ua",countrycodes:"ua,pl,by,ru,ro,md,tr",limit:5,email:"admin@duckarchive.com"}}),h=u.useCallback(async r=>{if(!r.trim()){l([]);return}try{const a=await p.search({query:r});l(a)}catch{l([])}},[p]);u.useEffect(()=>{const r=setTimeout(()=>{h(t)},300);return()=>clearTimeout(r)},[t]);const v=r=>{s(r.label),d.setView([r.y,r.x],15),d.fire("geosearch/showlocation",{location:r,marker:null}),e==null||e([r.y,r.x])},g=r=>{s(r)},x=r=>{if(r){const a=c[r];a&&v(a)}};return o.jsx("div",{ref:n,className:"absolute leaflet-top leaflet-left",children:o.jsx(z.Autocomplete,{"aria-label":"Пошук за сучасною назвою",className:"leaflet-control w-auto bg-background rounded-xl shadow text-foreground",defaultItems:c,inputValue:t,listboxProps:{emptyContent:"Нічого не знайдено. Уточніть свій запит."},placeholder:"Пошук за сучасною назвою",startContent:o.jsx(Q,{}),variant:"bordered",onClick:r=>r.stopPropagation(),onInputChange:g,onMouseDown:r=>r.stopPropagation(),onSelectionChange:x,children:r=>o.jsx(z.AutocompleteItem,{startContent:o.jsx(X,{}),textValue:r.label,children:r.label},c.indexOf(r))})})});V.displayName="MapLocationSearch";const i="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson",ee=[{year:1500,url:`${i}/countries/1500.geojson`},{year:1530,url:`${i}/countries/1530.geojson`},{year:1600,url:`${i}/countries/1600.geojson`},{year:1650,url:`${i}/countries/1650.geojson`},{year:1700,url:`${i}/countries/1700.geojson`},{year:1715,url:`${i}/countries/1715.geojson`},{year:1783,url:`${i}/countries/1783.geojson`},{year:1800,url:`${i}/countries/1800.geojson`},{year:1815,url:`${i}/countries/1815.geojson`},{year:1880,url:`${i}/countries/1880.geojson`},{year:1900,url:`${i}/countries/1900.geojson`},{year:1914,url:`${i}/countries/1914.geojson`},{year:1920,url:`${i}/countries/1920.geojson`},{year:1930,url:`${i}/countries/1930.geojson`},{year:1938,url:`${i}/countries/1938.geojson`},{year:1945,url:`${i}/countries/1945.geojson`},{year:1960,url:`${i}/countries/1960.geojson`},{year:1991,url:`${i}/countries/1991.geojson`}],te=[{year:1897,url:`${i}/states/1897.geojson`},{year:1914,url:`${i}/states/1914.geojson`},{year:1937,url:`${i}/states/1937.geojson`},{year:1945,url:`${i}/states/1945.geojson`},{year:1991,url:`${i}/states/1991.geojson`}],$=(e,t,s=!1)=>{if(s){const l=t.find(({year:n})=>n===e);return l?l.url:null}const c=t.filter(({year:l})=>l>0&&l<=e).sort((l,n)=>n.year-l.year);return c.length>0?c[0].url:null},W=e=>fetch(e).then(t=>t.json()),oe=e=>{const[t,s]=u.useState(e),c=$(t,ee),{data:l,isLoading:n,isValidating:d}=S(c,W,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),p=$(t,te,!0),{data:h,isLoading:v,isValidating:g}=S(p,W,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),x=u.useMemo(()=>l||null,[l]),r=u.useMemo(()=>h||null,[h]);return{countries:x,states:r,updateYear:j=>{s(j)},isLoading:n||v||d||g}},se=({level1:e,level2:t,level3:s})=>o.jsx("div",{className:"absolute leaflet-bottom leaflet-left",children:o.jsx(N.Card,{className:"leaflet-control max-w-sm pointer-events-none rounded-xl",children:o.jsx(N.CardBody,{className:"py-2",children:o.jsxs("div",{className:"flex flex-col gap-0",children:[s&&o.jsx("p",{className:"text-large",children:s}),t&&o.jsx("p",{className:"text-small text-default-500",children:t}),e&&o.jsx("p",{className:"text-small text-default-500",children:e})]})})})}),ne=[{value:1897,label:"Російська Імперія"},{value:1914,label:"WWI"},{value:1937,label:"Перед WWII"},{value:1945,label:"Після WWII"},{value:1991,label:"Незалежність"}],re=e=>{const t=parseInt(e,10);return/^\d{4}$/.test(e)&&t>=1500&&t<=1991},le=({value:e,onChange:t})=>{const[s,c]=u.useState(e.toString()),[l,n]=u.useState(!1),[d,p]=u.useState(!1),h=R(),v=a=>{const j=a.replace(/\D/g,"").slice(0,4);if(c(j),j.length===4){const f=re(j);p(!f),f&&t(parseInt(j,10))}else p(!1)},g=a=>{c(a.toString()),t(a),n(!1),p(!1)},x=()=>{n(!0)},r=()=>{setTimeout(()=>n(!1),150)};return o.jsx("div",{ref:h,className:"absolute leaflet-top leaflet-right",children:o.jsxs("div",{className:"leaflet-control bg-background rounded-xl shadow",children:[o.jsx(P.Input,{classNames:{inputWrapper:"bg-background relative",input:"text-sm text-foreground"},errorMessage:d?"Введіть рік від 1600 до 2025":"",isInvalid:d,placeholder:"1897",type:"text",value:s,variant:"bordered",onBlur:r,onFocus:x,onValueChange:v}),l&&o.jsx("div",{className:"flex flex-col gap-1 p-2",children:ne.map(a=>o.jsxs(B.Button,{className:"text-xs justify-start",color:"default",size:"sm",variant:e===a.value?"flat":"bordered",onPress:()=>g(a.value),children:[a.value," - ",a.label]},a.value))})]})})},E=["green","darkblue","purple","orange","blue","red","yellow"],ce=e=>{var c;const t=((c=e.properties)==null?void 0:c.admin_level_1_ID)||e.id||0;if(t===22)return"gold";const s=t%E.length;return E[s]},k=(e,t,s=1)=>{const c=e?ce(e):"gray";return{color:c,fillColor:c,weight:s,opacity:t?1:.5,fillOpacity:t?.1:0,interactive:!0}},A=u.memo(u.forwardRef(({data:e,onEachFeature:t},s)=>e?o.jsx(m.GeoJSON,{ref:s,data:e,style:c=>k(c,!1,0),onEachFeature:t}):null));A.displayName="CountriesLayer";const _=u.memo(({data:e,onEachFeature:t})=>e?o.jsx(m.GeoJSON,{data:e,style:s=>k(s,!1,2),onEachFeature:t}):null);_.displayName="StatesLayer";const ae=({year:e,onYearChange:t})=>{var r,a,j;const[s,c]=u.useState(null),[l,n]=u.useState(null),{countries:d,states:p,updateYear:h,isLoading:v}=oe(e);u.useEffect(()=>{h(e),c(null),n(null)},[e]);const g=u.useCallback((f,C)=>{C.on({mouseover:w=>{c(f),w.target.setStyle(k(f,!1,1))},mouseout:w=>{c(null),w.target.setStyle(k(f,!1,0))}})},[]),x=u.useCallback((f,C)=>{C.on({mouseover:w=>{n(f);const b=d==null?void 0:d.features.find(D=>{var I,M;return((I=D.id)==null?void 0:I.toString())===((M=f.properties)==null?void 0:M.admin_level_1_ID.toString())});b&&c(b),w.target.setStyle(k(f,!0,4))},mouseout:w=>{n(null),w.target.setStyle(k(f,!1,2))}})},[d]);return o.jsxs(o.Fragment,{children:[v?o.jsx("div",{className:"absolute z-[1001] top-0 left-0 w-full h-full flex items-center justify-center backdrop-blur-sm bg-white/50",children:o.jsx(q.Spinner,{})}):o.jsxs(o.Fragment,{children:[d&&o.jsx(A,{data:d,onEachFeature:g}),p&&o.jsx(_,{data:p,onEachFeature:x})]}),t&&o.jsx(le,{value:e,onChange:t}),(s||l)&&o.jsx(se,{level1:(r=s==null?void 0:s.properties)==null?void 0:r.admin_level_1,level2:(a=l==null?void 0:l.properties)==null?void 0:a.admin_level_2,level3:(j=l==null?void 0:l.properties)==null?void 0:j.admin_level_3})]})},ie="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson/ukraine.geojson",ue=e=>fetch(e).then(t=>t.json()),de=()=>{const{data:e}=S(ie,ue,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1});return e&&o.jsx(m.GeoJSON,{data:e,style:{color:"gray",weight:4,fillColor:"transparent",opacity:.4,interactive:!1}})},he={zoomControl:!1,doubleClickZoom:!1,closePopupOnClick:!1,dragging:!1,zoomSnap:0,zoomDelta:1,trackResize:!1,touchZoom:!1,scrollWheelZoom:!1},pe={zoomControl:!1,scrollWheelZoom:!0},me=({positions:e,onPositionChange:t,tileLayerProps:s,year:c=1897,onYearChange:l,hideLayers:n,...d})=>o.jsxs(m.MapContainer,{worldCopyJump:!0,center:[49.0139,31.2858],style:{height:"100%",width:"100%"},zoom:6,...t?pe:he,...d,children:[o.jsx(m.TileLayer,{className:"grayscale",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",...s}),!(n!=null&&n.ukraineLayer)&&o.jsx(de,{}),!(n!=null&&n.searchInput)&&o.jsx(V,{onSelect:t}),!(n!=null&&n.historicalLayers)&&o.jsx(ae,{year:c,onYearChange:l}),!(n!=null&&n.locationMarker)&&(t?o.jsx(L,{value:e[0],onChange:t}):e.map((p,h)=>o.jsx(L,{value:p},h)))]});module.exports=me;
//# sourceMappingURL=index.cjs.map
