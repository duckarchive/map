"use strict";const o=require("react/jsx-runtime"),j=require("react-leaflet"),i=require("react"),L=require("leaflet"),F=require("leaflet-geosearch"),N=require("@heroui/autocomplete"),P=require("@heroui/spinner"),S=require("swr"),M=require("@heroui/card"),V=require("@heroui/button"),A=require("@heroui/input"),T='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512"><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 48c-79.5 0-144 61.39-144 137 0 87 96 224.87 131.25 272.49a15.77 15.77 0 0 0 25.5 0C304 409.89 400 272.07 400 185c0-75.61-64.5-137-144-137z"/><circle cx="256" cy="192" r="48" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>',$=({value:e,onChange:t})=>{const a=!t,r=j.useMap();j.useMapEvents({click(s){if(!s.latlng||a)return;const{lat:u,lng:p}=s.latlng;t==null||t([u,p,e[2]||0])}}),i.useEffect(()=>{if(a)return;const s=f=>{if(f.ctrlKey){f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation();const y=f.deltaY,x=100,n=100,d=1e4;let m=e[2]||0;y<0?m=Math.min((e[2]||0)+x,d):m=Math.max((e[2]||0)-x,n),m!==e[2]&&(t==null||t([e[0],e[1],m]))}},u=f=>{f.key==="Control"&&r.scrollWheelZoom.disable()},p=f=>{f.key==="Control"&&r.scrollWheelZoom.enable()},g=r.getContainer();return g.addEventListener("wheel",s,{passive:!1,capture:!0}),document.addEventListener("keydown",u),document.addEventListener("keyup",p),()=>{g.removeEventListener("wheel",s,{capture:!0}),document.removeEventListener("keydown",u),document.removeEventListener("keyup",p),r.scrollWheelZoom.enable()}},[a,r,e,t]);const l=i.useMemo(()=>L.divIcon({html:T,className:"io5-icon",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]}),[]);return e?o.jsxs(o.Fragment,{children:[o.jsx(j.Marker,{position:e,icon:l}),e[2]&&e[2]>0&&o.jsx(j.Circle,{center:e,radius:e[2],pathOptions:{color:"currentColor",fillColor:"currentColor",fillOpacity:.2,weight:0}})]}):null},O=()=>{const e=i.useRef(null);return i.useEffect(()=>{e.current&&L.DomEvent.disableClickPropagation(e.current)},[e.current]),e},U=()=>o.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})}),B=()=>o.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[o.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),o.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),_=i.memo(({onSelect:e})=>{const[t,a]=i.useState(""),[r,l]=i.useState([]),s=O(),u=j.useMap(),p=new F.OpenStreetMapProvider({params:{"accept-language":"ua",countrycodes:"ua,pl,by,ru,ro,md,tr",limit:5,email:"admin@duckarchive.com"}}),g=i.useCallback(async n=>{if(!n.trim()){l([]);return}try{const d=await p.search({query:n});l(d)}catch{l([])}},[p]);i.useEffect(()=>{const n=setTimeout(()=>{g(t)},300);return()=>clearTimeout(n)},[t]);const f=n=>{a(n.label),u.setView([n.y,n.x],15),u.fire("geosearch/showlocation",{location:n,marker:null}),e==null||e([n.y,n.x])},y=n=>{a(n)},x=n=>{if(n){const d=r[n];d&&f(d)}};return o.jsx("div",{ref:s,className:"absolute leaflet-top leaflet-left",children:o.jsx(N.Autocomplete,{"aria-label":"Пошук за сучасною назвою",className:"leaflet-control w-auto bg-background rounded-xl shadow text-foreground",defaultItems:r,inputValue:t,listboxProps:{emptyContent:"Нічого не знайдено. Уточніть свій запит."},placeholder:"Пошук за сучасною назвою",startContent:o.jsx(U,{}),variant:"bordered",onClick:n=>n.stopPropagation(),onInputChange:y,onMouseDown:n=>n.stopPropagation(),onSelectionChange:x,children:n=>o.jsx(N.AutocompleteItem,{startContent:o.jsx(B,{}),textValue:n.label,children:n.label},r.indexOf(n))})})});_.displayName="MapLocationSearch";const c="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson",G=[{year:1500,url:`${c}/countries/1500.geojson`},{year:1530,url:`${c}/countries/1530.geojson`},{year:1600,url:`${c}/countries/1600.geojson`},{year:1650,url:`${c}/countries/1650.geojson`},{year:1700,url:`${c}/countries/1700.geojson`},{year:1715,url:`${c}/countries/1715.geojson`},{year:1783,url:`${c}/countries/1783.geojson`},{year:1800,url:`${c}/countries/1800.geojson`},{year:1815,url:`${c}/countries/1815.geojson`},{year:1880,url:`${c}/countries/1880.geojson`},{year:1900,url:`${c}/countries/1900.geojson`},{year:1914,url:`${c}/countries/1914.geojson`},{year:1920,url:`${c}/countries/1920.geojson`},{year:1930,url:`${c}/countries/1930.geojson`},{year:1938,url:`${c}/countries/1938.geojson`},{year:1945,url:`${c}/countries/1945.geojson`},{year:1960,url:`${c}/countries/1960.geojson`},{year:1991,url:`${c}/countries/1991.geojson`}],Y=[{year:1897,url:`${c}/states/1897.geojson`},{year:1914,url:`${c}/states/1914.geojson`},{year:1937,url:`${c}/states/1937.geojson`},{year:1945,url:`${c}/states/1945.geojson`},{year:1991,url:`${c}/states/1991.geojson`}],W=(e,t,a=!1)=>{if(a){const l=t.find(({year:s})=>s===e);return l?l.url:null}const r=t.filter(({year:l})=>l>0&&l<=e).sort((l,s)=>s.year-l.year);return r.length>0?r[0].url:null},E=e=>fetch(e).then(t=>t.json()),Z=e=>{const[t,a]=i.useState(e),r=W(t,G),{data:l,isLoading:s,isValidating:u}=S(r,E,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),p=W(t,Y,!0),{data:g,isLoading:f,isValidating:y}=S(p,E,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),x=i.useMemo(()=>l||null,[l]),n=i.useMemo(()=>g||null,[g]);return{countries:x,states:n,updateYear:m=>{a(m)},isLoading:s||f||u||y}},H=({level1:e,level2:t,level3:a})=>o.jsx("div",{className:"absolute leaflet-bottom leaflet-left",children:o.jsx(M.Card,{className:"leaflet-control max-w-sm pointer-events-none rounded-xl",children:o.jsx(M.CardBody,{className:"py-2",children:o.jsxs("div",{className:"flex flex-col gap-0",children:[a&&o.jsx("p",{className:"text-large",children:a}),t&&o.jsx("p",{className:"text-small text-default-500",children:t}),e&&o.jsx("p",{className:"text-small text-default-500",children:e})]})})})}),J=[{value:1897,label:"Російська Імперія"},{value:1914,label:"WWI"},{value:1937,label:"Перед WWII"},{value:1945,label:"Після WWII"},{value:1991,label:"Незалежність"}],K=e=>{const t=parseInt(e,10);return/^\d{4}$/.test(e)&&t>=1500&&t<=1991},Q=({value:e,onChange:t})=>{const[a,r]=i.useState(e.toString()),[l,s]=i.useState(!1),[u,p]=i.useState(!1),g=O(),f=d=>{const m=d.replace(/\D/g,"").slice(0,4);if(r(m),m.length===4){const h=K(m);p(!h),h&&t(parseInt(m,10))}else p(!1)},y=d=>{r(d.toString()),t(d),s(!1),p(!1)},x=()=>{s(!0)},n=()=>{setTimeout(()=>s(!1),150)};return o.jsx("div",{ref:g,className:"absolute leaflet-top leaflet-right",children:o.jsxs("div",{className:"leaflet-control bg-background rounded-xl shadow",children:[o.jsx(A.Input,{classNames:{inputWrapper:"bg-background relative",input:"text-sm text-foreground"},errorMessage:u?"Введіть рік від 1600 до 2025":"",isInvalid:u,placeholder:"1897",type:"text",value:a,variant:"bordered",onBlur:n,onFocus:x,onValueChange:f}),l&&o.jsx("div",{className:"flex flex-col gap-1 p-2",children:J.map(d=>o.jsxs(V.Button,{className:"text-xs justify-start",color:"default",size:"sm",variant:e===d.value?"flat":"bordered",onPress:()=>y(d.value),children:[d.value," - ",d.label]},d.value))})]})})},R=["green","darkblue","purple","orange","blue","red","yellow"],X=e=>{var r;const t=((r=e.properties)==null?void 0:r.admin_level_1_ID)||e.id||0;if(t===22)return"gold";const a=t%R.length;return R[a]},k=(e,t,a=1)=>{const r=e?X(e):"gray";return{color:r,fillColor:r,weight:a,opacity:t?1:.5,fillOpacity:t?.1:0,interactive:!0}},z=i.memo(i.forwardRef(({data:e,onEachFeature:t},a)=>e?o.jsx(j.GeoJSON,{ref:a,data:e,style:r=>k(r,!1,0),onEachFeature:t}):null));z.displayName="CountriesLayer";const q=i.memo(({data:e,onEachFeature:t})=>e?o.jsx(j.GeoJSON,{data:e,style:a=>k(a,!1,2),onEachFeature:t}):null);q.displayName="StatesLayer";const ee=({year:e,onYearChange:t})=>{var n,d,m;const[a,r]=i.useState(null),[l,s]=i.useState(null),{countries:u,states:p,updateYear:g,isLoading:f}=Z(e);i.useEffect(()=>{g(e),r(null),s(null)},[e]);const y=i.useCallback((h,b)=>{b.on({mouseover:v=>{r(h),v.target.setStyle(k(h,!1,1))},mouseout:v=>{r(null),v.target.setStyle(k(h,!1,0))}})},[]),x=i.useCallback((h,b)=>{b.on({mouseover:v=>{s(h);const w=u==null?void 0:u.features.find(D=>{var C,I;return((C=D.id)==null?void 0:C.toString())===((I=h.properties)==null?void 0:I.admin_level_1_ID.toString())});w&&r(w),v.target.setStyle(k(h,!0,4))},mouseout:v=>{s(null),v.target.setStyle(k(h,!1,2))}})},[u]);return o.jsxs(o.Fragment,{children:[f?o.jsx("div",{className:"absolute z-[1001] top-0 left-0 w-full h-full flex items-center justify-center backdrop-blur-sm bg-white/50",children:o.jsx(P.Spinner,{})}):o.jsxs(o.Fragment,{children:[u&&o.jsx(z,{data:u,onEachFeature:y}),p&&o.jsx(q,{data:p,onEachFeature:x})]}),t&&o.jsx(Q,{value:e,onChange:t}),(a||l)&&o.jsx(H,{level1:(n=a==null?void 0:a.properties)==null?void 0:n.admin_level_1,level2:(d=l==null?void 0:l.properties)==null?void 0:d.admin_level_2,level3:(m=l==null?void 0:l.properties)==null?void 0:m.admin_level_3})]})},te="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson/ukraine.geojson",oe=e=>fetch(e).then(t=>t.json()),se=()=>{const{data:e}=S(te,oe,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1});return e&&o.jsx(j.GeoJSON,{data:e,style:{color:"gray",weight:4,fillColor:"transparent",opacity:.4,interactive:!1}})},ne={zoomControl:!1,doubleClickZoom:!1,closePopupOnClick:!1,dragging:!1,zoomSnap:0,zoomDelta:1,trackResize:!1,touchZoom:!1,scrollWheelZoom:!1},re={zoomControl:!1,scrollWheelZoom:!0},ae=({positions:e,onPositionChange:t,tileLayerProps:a,year:r=1897,onYearChange:l,hideLayers:s,...u})=>o.jsxs(j.MapContainer,{worldCopyJump:!0,center:[49.0139,31.2858],style:{height:"100%",width:"100%"},zoom:6,...u,...t?re:ne,children:[o.jsx(j.TileLayer,{className:"grayscale",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",...a}),!(s!=null&&s.ukraineLayer)&&o.jsx(se,{}),!(s!=null&&s.searchInput)&&o.jsx(_,{onSelect:t}),!(s!=null&&s.historicalLayers)&&o.jsx(ee,{year:r,onYearChange:l}),!(s!=null&&s.locationMarker)&&(t?o.jsx($,{value:e[0],onChange:t}):e.map((p,g)=>o.jsx($,{value:p},g)))]});module.exports=ae;
//# sourceMappingURL=index.cjs.map
