"use strict";const t=require("react/jsx-runtime");require("leaflet-defaulticon-compatibility");const y=require("react-leaflet"),i=require("react"),R=require("leaflet"),V=require("leaflet-geosearch"),N=require("@heroui/autocomplete"),F=require("@heroui/spinner"),S=require("swr"),M=require("@heroui/card"),D=require("@heroui/button"),z=require("@heroui/input"),B='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512"><path fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 48c-79.5 0-144 61.39-144 137 0 87 96 224.87 131.25 272.49a15.77 15.77 0 0 0 25.5 0C304 409.89 400 272.07 400 185c0-75.61-64.5-137-144-137z"/><circle cx="256" cy="192" r="48" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>',G=({value:e,onChange:o,radius:n,onRadiusChange:s})=>{const r=y.useMap();y.useMapEvents({click(u){if(!u.latlng)return;const{lat:l,lng:h}=u.latlng;o([l,h])}}),i.useEffect(()=>{if(!s||n===void 0)return;const u=p=>{if(p.ctrlKey){p.preventDefault(),p.stopPropagation(),p.stopImmediatePropagation();const a=p.deltaY,g=100,f=100,x=1e4;let m=n;a<0?m=Math.min(n+g,x):m=Math.max(n-g,f),m!==n&&s(m)}},l=p=>{p.key==="Control"&&r.scrollWheelZoom.disable()},h=p=>{p.key==="Control"&&r.scrollWheelZoom.enable()},j=r.getContainer();return j.addEventListener("wheel",u,{passive:!1,capture:!0}),document.addEventListener("keydown",l),document.addEventListener("keyup",h),()=>{j.removeEventListener("wheel",u,{capture:!0}),document.removeEventListener("keydown",l),document.removeEventListener("keyup",h),r.scrollWheelZoom.enable()}},[r,n,s]);const d=i.useMemo(()=>R.divIcon({html:B,className:"io5-icon",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]}),[]);return e?t.jsxs(t.Fragment,{children:[t.jsx(y.Marker,{position:e,icon:d}),n&&n>0&&t.jsx(y.Circle,{center:e,radius:n,pathOptions:{color:"currentColor",fillColor:"currentColor",fillOpacity:.2,weight:0}})]}):null},L=()=>{const e=i.useRef(null);return i.useEffect(()=>{e.current&&R.DomEvent.disableClickPropagation(e.current)},[e.current]),e},U=()=>t.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})}),Y=()=>t.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2}),t.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})]}),O=i.memo(()=>{const[e,o]=i.useState(""),[n,s]=i.useState([]),r=L(),d=y.useMap(),u=new V.OpenStreetMapProvider({params:{"accept-language":"ua",countrycodes:"ua,pl,by,ru,ro,md,tr",limit:5,email:"admin@duckarchive.com"}}),l=i.useCallback(async a=>{if(!a.trim()){s([]);return}try{const g=await u.search({query:a});s(g)}catch{s([])}},[u]);i.useEffect(()=>{const a=setTimeout(()=>{l(e)},300);return()=>clearTimeout(a)},[e]);const h=a=>{o(a.label),d.setView([a.y,a.x],15),d.fire("geosearch/showlocation",{location:a,marker:null})},j=a=>{o(a)},p=a=>{if(a){const g=n[a];g&&h(g)}};return t.jsx("div",{ref:r,className:"absolute leaflet-top leaflet-left",children:t.jsx(N.Autocomplete,{"aria-label":"Пошук за сучасною назвою",className:"leaflet-control w-auto bg-white rounded-xl shadow text-gray-900",defaultItems:n,inputValue:e,listboxProps:{emptyContent:"Нічого не знайдено. Уточніть свій запит."},placeholder:"Пошук за сучасною назвою",startContent:t.jsx(U,{}),variant:"bordered",onClick:a=>a.stopPropagation(),onInputChange:j,onMouseDown:a=>a.stopPropagation(),onSelectionChange:p,children:a=>t.jsx(N.AutocompleteItem,{startContent:t.jsx(Y,{}),textValue:a.label,children:a.label},n.indexOf(a))})})});O.displayName="MapLocationSearch";const c="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson",A=[{year:1500,url:`${c}/countries/1500.geojson`},{year:1530,url:`${c}/countries/1530.geojson`},{year:1600,url:`${c}/countries/1600.geojson`},{year:1650,url:`${c}/countries/1650.geojson`},{year:1700,url:`${c}/countries/1700.geojson`},{year:1715,url:`${c}/countries/1715.geojson`},{year:1783,url:`${c}/countries/1783.geojson`},{year:1800,url:`${c}/countries/1800.geojson`},{year:1815,url:`${c}/countries/1815.geojson`},{year:1880,url:`${c}/countries/1880.geojson`},{year:1900,url:`${c}/countries/1900.geojson`},{year:1914,url:`${c}/countries/1914.geojson`},{year:1920,url:`${c}/countries/1920.geojson`},{year:1930,url:`${c}/countries/1930.geojson`},{year:1938,url:`${c}/countries/1938.geojson`},{year:1945,url:`${c}/countries/1945.geojson`},{year:1960,url:`${c}/countries/1960.geojson`},{year:1991,url:`${c}/countries/1991.geojson`}],T=[{year:1897,url:`${c}/states/1897.geojson`},{year:1914,url:`${c}/states/1914.geojson`},{year:1937,url:`${c}/states/1937.geojson`},{year:1945,url:`${c}/states/1945.geojson`},{year:1991,url:`${c}/states/1991.geojson`}],$=(e,o,n=!1)=>{if(n){const r=o.find(({year:d})=>d===e);return r?r.url:null}const s=o.filter(({year:r})=>r>0&&r<=e).sort((r,d)=>d.year-r.year);return s.length>0?s[0].url:null},W=e=>fetch(e).then(o=>o.json()),H=e=>{const[o,n]=i.useState(e),s=$(o,A),{data:r,isLoading:d,isValidating:u}=S(s,W,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),l=$(o,T,!0),{data:h,isLoading:j,isValidating:p}=S(l,W,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1}),a=i.useMemo(()=>r||null,[r]),g=i.useMemo(()=>h||null,[h]);return{countries:a,states:g,updateYear:x=>{n(x)},isLoading:d||j||u||p}},J=({level1:e,level2:o,level3:n})=>t.jsx("div",{className:"absolute leaflet-bottom leaflet-left",children:t.jsx(M.Card,{className:"leaflet-control max-w-sm pointer-events-none rounded-xl",children:t.jsx(M.CardBody,{className:"py-2",children:t.jsxs("div",{className:"flex flex-col gap-0",children:[n&&t.jsx("p",{className:"text-large",children:n}),o&&t.jsx("p",{className:"text-small text-default-500",children:o}),e&&t.jsx("p",{className:"text-small text-default-500",children:e})]})})})}),K=[{value:1897,label:"Російська Імперія"},{value:1914,label:"WWI"},{value:1937,label:"Перед WWII"},{value:1945,label:"Після WWII"},{value:1991,label:"Незалежність"}],Z=e=>{const o=parseInt(e,10);return/^\d{4}$/.test(e)&&o>=1500&&o<=1991},Q=({value:e,onChange:o})=>{const[n,s]=i.useState(e.toString()),[r,d]=i.useState(!1),[u,l]=i.useState(!1),h=L(),j=f=>{const x=f.replace(/\D/g,"").slice(0,4);if(s(x),x.length===4){const m=Z(x);l(!m),m&&o(parseInt(x,10))}else l(!1)},p=f=>{s(f.toString()),o(f),d(!1),l(!1)},a=()=>{d(!0)},g=()=>{setTimeout(()=>d(!1),150)};return t.jsx("div",{ref:h,className:"absolute leaflet-top leaflet-right",children:t.jsxs("div",{className:"leaflet-control bg-white rounded-xl shadow",children:[t.jsx(z.Input,{classNames:{inputWrapper:"bg-default-100 relative",input:"text-sm text-gray-900"},errorMessage:u?"Введіть рік від 1600 до 2025":"",isInvalid:u,placeholder:"1897",type:"text",value:n,variant:"bordered",onBlur:g,onFocus:a,onValueChange:j}),r&&t.jsx("div",{className:"flex flex-col gap-1 p-2",children:K.map(f=>t.jsxs(D.Button,{className:"text-xs justify-start",color:"default",size:"sm",variant:e===f.value?"flat":"bordered",onPress:()=>p(f.value),children:[f.value," - ",f.label]},f.value))})]})})},E=["green","darkblue","purple","orange","blue","red","yellow"],X=e=>{var s;const o=((s=e.properties)==null?void 0:s.admin_level_1_ID)||e.id||0;if(o===22)return"gold";const n=o%E.length;return E[n]},k=(e,o,n=1)=>{const s=e?X(e):"gray";return{color:s,fillColor:s,weight:n,opacity:o?1:.5,fillOpacity:o?.1:0,interactive:!0}},P=i.memo(i.forwardRef(({data:e,onEachFeature:o},n)=>e?t.jsx(y.GeoJSON,{ref:n,data:e,style:s=>k(s,!1,0),onEachFeature:o}):null));P.displayName="CountriesLayer";const _=i.memo(({data:e,onEachFeature:o})=>e?t.jsx(y.GeoJSON,{data:e,style:n=>k(n,!1,2),onEachFeature:o}):null);_.displayName="StatesLayer";const ee=({year:e,onYearChange:o})=>{var g,f,x;const[n,s]=i.useState(null),[r,d]=i.useState(null),{countries:u,states:l,updateYear:h,isLoading:j}=H(e);i.useEffect(()=>{h(e),s(null),d(null)},[e]);const p=i.useCallback((m,w)=>{w.on({mouseover:v=>{s(m),v.target.setStyle(k(m,!1,1))},mouseout:v=>{s(null),v.target.setStyle(k(m,!1,0))}})},[]),a=i.useCallback((m,w)=>{w.on({mouseover:v=>{d(m);const C=u==null?void 0:u.features.find(q=>{var b,I;return((b=q.id)==null?void 0:b.toString())===((I=m.properties)==null?void 0:I.admin_level_1_ID.toString())});C&&s(C),v.target.setStyle(k(m,!0,4))},mouseout:v=>{d(null),v.target.setStyle(k(m,!1,2))}})},[u]);return t.jsxs(t.Fragment,{children:[j?t.jsx("div",{className:"absolute z-[1001] top-0 left-0 w-full h-full flex items-center justify-center backdrop-blur-sm bg-white/50",children:t.jsx(F.Spinner,{})}):t.jsxs(t.Fragment,{children:[u&&t.jsx(P,{data:u,onEachFeature:p}),l&&t.jsx(_,{data:l,onEachFeature:a})]}),o&&t.jsx(Q,{value:e,onChange:o}),(n||r)&&t.jsx(J,{level1:(g=n==null?void 0:n.properties)==null?void 0:g.admin_level_1,level2:(f=r==null?void 0:r.properties)==null?void 0:f.admin_level_2,level3:(x=r==null?void 0:r.properties)==null?void 0:x.admin_level_3})]})},te="https://raw.githubusercontent.com/duckarchive/map/refs/heads/main/geojson/ukraine.geojson",oe=e=>fetch(e).then(o=>o.json()),ne=()=>{const{data:e}=S(te,oe,{revalidateOnFocus:!1,revalidateOnReconnect:!1,refreshWhenHidden:!1,refreshWhenOffline:!1});return e&&t.jsx(y.GeoJSON,{data:e,style:{color:"gray",weight:4,fillColor:"transparent",opacity:.4,interactive:!1}})},se=({position:e,onPositionChange:o,tileLayerProps:n,year:s=1897,onYearChange:r,radius:d,onRadiusChange:u,hideLayers:l,...h})=>t.jsxs(y.MapContainer,{scrollWheelZoom:!0,worldCopyJump:!0,center:[49.0139,31.2858],style:{height:"100%",width:"100%"},zoom:6,zoomControl:!1,...h,children:[t.jsx(y.TileLayer,{className:"grayscale",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",...n}),!(l!=null&&l.ukraineLayer)&&t.jsx(ne,{}),!(l!=null&&l.searchInput)&&t.jsx(O,{}),!(l!=null&&l.historicalLayers)&&t.jsx(ee,{year:s,onYearChange:r}),!(l!=null&&l.locationMarker)&&t.jsx(G,{value:e,onChange:o,radius:d,onRadiusChange:u})]});module.exports=se;
//# sourceMappingURL=index.cjs.map
